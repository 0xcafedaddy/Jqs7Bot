<html>
<head>
  <meta charset = "utf-8">
  <title>Jqs7Bot</title>
</head>
<body>
<div id="search" align="center" class="item">
  <h1 style="text-align:center;">Telegram 中文群组数据统计</h1>
  <div  class="ui  center icon input">
    <input id="user" type="text" placeholder="UserName...">
    <i id="us" class="search link icon"></i>
  </div>
</div>
<div  align="center">
  <div  class="ui" id = "total" style = "height:500px;width:1200px"></div>
</div>
</body>
</html>

<script src = "http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script src ="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
<link href="http://cdn.bootcss.com/semantic-ui/2.1.3/semantic.min.css" rel="stylesheet">
<script src="//cdn.bootcss.com/semantic-ui/2.1.3/semantic.min.js"></script>
<script src = "//cdn.bootcss.com/echarts/2.2.7/echarts.js"></script>
<script type = "text/javascript">
  require.config({
    paths: {
      echarts: 'http://cdn.bootcss.com/echarts/2.2.7'
    }
  });
  require(
          [
            'echarts',
            'echarts/chart/line'
          ],
          function (ec) {
            var total = ec.init(document.getElementById('total'));
            var user;
            $("#user").keyup(function () {
              if (event.keyCode == 13) {
                user = localStorage.user = $("#user").val();
                window.location.href = '/user/@' + user;
              }
            });
            $("#us").click(function () {
              user = localStorage.user = $("#user").val();
              window.location.href = '/user/@'+user;
            });
            $("#total").backstretch(['../assets/bg.jpg',{duration: 4000}]);
            var total_option = {
              legend:{
                data:["日发言量","日活跃用户"]
              },
              tooltip: {
                show: true,
                formatter: function (params, ticket, callback) {
                  if (params['seriesName']=="日活跃用户"){
                    return '<div class="ui blue label">'+params['name']+ '</div></br>'+ +params['data']+'</br>';
                    //return params['name'] + '</br>' + "活跃用户量 : " + params['data']
                  }
                  if (params['data'] == "") {
                    params['data'] = "0"
                  }
                  var res = params['name'] + " : " + params['data'] + '</br></br>';
                  $.ajax({
                    url: "/rank/" + params['name']
                  }).done(function (data) {
                    for (var i in data['rank']) {
                      var percent = Number(data['rank'][i]['percent']);
                      percent = percent.toFixed(2);
                      var name = data['rank'][i]['name']
                      var count = data['rank'][i]['count']
                      res += '<div class="ui circular pink label" style="margin-bottom=10px"><a href="/user/' +
                              encodeURI(name) + '">' + name + '</a></div>' +
                              '<div class="ui circular yellow label">' + count +
                              '</div><div class="ui circular violet label">'+percent+'%</div></br>';
                      //res += '<a href="/user/' + encodeURI(name) + '">' + name + '</a>' +
                      //        " : " + count + "/" + percent + '%</br>';
                    }
                    callback(ticket, res);
                  });
                  return 'loading';
                },
                hideDelay: 1000
              },
              yAxis: [{},{
                scale: true
              }],
              xAxis: [
                {
                  data: [{{range $element := .total}}{{with $element}}{{.date.Format "2006-01-02"}},{{end}}{{end}}]
                }
              ],
              series: [
                {
                  "name": "日发言量",
                  "type": "line",
                  "data": [{{range $element := .total}}{{with $element}}{{.total}},{{end}}{{end}}]
                },
                {
                  "name": "日活跃用户",
                  "type": "line",
                  "yAxisIndex":1,
                  "data": [{{range $element := .users}}{{with $element}}{{.userCount}},{{end}}{{end}}]
                }
              ]
            };
            total.setOption(total_option);
          }
  );
</script>
